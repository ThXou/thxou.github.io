
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>iOS: Aprenent Sobre Delegació, Protocols I La Classe UIAlertView - Luis Cardenas ThXou</title>
  <meta name="author" content="Luis Cardenas">

  
  <meta name="description" content="En aquesta ocasió he volgut parlar sobre la delegació, un patró molt comú en Cocoa Touch que a molts principiants se&#8217;ns pot ennuegar, com ha &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ThXou.github.io/2012/10/19/ios-aprenent-sobre-delegacio-protocols-i-la-classe-uialertview">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Luis Cardenas ThXou" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2267618-8']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Luis Cardenas ThXou</a></h1>
  
    <h2>Ama la sabiduría. Desea el conocimiento</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ThXou.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">iOS: Aprenent Sobre Delegació, Protocols I La Classe UIAlertView</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-19T09:39:25+02:00" pubdate data-updated="true">Oct 19<span>th</span>, 2012</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://ThXou.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content">En aquesta ocasió he volgut parlar sobre la delegació, un patró molt comú en Cocoa Touch que a molts principiants se&#8217;ns pot ennuegar, com ha estat el meu cas. És en si un concepte molt senzill d&#8217;entendre, però és clar, depenent de qui t&#8217;ho expliqui. Espero explicar-ho ben perquè tots el puguin entendre, si no és així, digueu-m&#8217;ho en els comentaris.

El concepte delegació en Cocoa Touch es refereix específicament al fet que la teva &#8220;delegues&#8221; a un objecte i ho dotes amb la capacitat de respondre a certs esdeveniments ocorreguts en un altre objecte en particular. Aquest concepte és fàcilment comprensible si ho mires des del punt de vista de la necessitat que hi ha que &#8220;algú&#8221; hagi de rebre i manipular la informació de certs esdeveniments en certs objectes. Un exemple clar ho veiem en el GPS. Com podem saber si el GPS ja va trobar la nostra localització?, la informació retornada pel GPS està allí, però algú ha de rebre-la i treballar amb ella per poder mostrar aquesta localització. Doncs, aquest algú és el delegat. El procés de delegació es fa a través de la propietat <code>delegate</code>. Aquesta propietat no és comuna en totes les classes, solament algunes com <code>UIAccelerometer</code>, <code>UIActionSheet</code>, <code>CLLocationManager</code>, etc. la tenen ja que emeten missatges per als seus esdeveniments. Llavors, assignem a la propietat <code>delegate</code> d&#8217;un objecte la classe que volem que sigui l&#8217;encarregada de manipular els esdeveniments d&#8217;aquest objecte i llest, el delegat ja està preparat per rebre&#8217;ls i manipular-los.

Els esdeveniments estan representats en codi a través de funcions (Mètodes) les quals són cridades cada vegada que l&#8217;esdeveniment ocorre. L&#8217;objecte delegat s&#8217;encarrega d&#8217;implementar aquestes funcions per a la quantitat d&#8217;esdeveniments que s&#8217;envien depenent de cada objecte. Cada objecte delegat solament pot rebre missatges per a esdeveniments d&#8217;un sol objecte en particular, i aquests poden ser més d&#8217;un.
<h2>Aplicació pràctica</h2>
Ben. Seguint amb la meva idea que tot s&#8217;aprèn millor si ho portem a la pràctica, he desenvolupat una petita aplicació que utilitza la classe <code>UIAlertView</code> per mostrar una finestra com la qual vam veure en <a href="http://www.thxou.com/2012/01/31/programando-notificaciones-locales-con-uilocalnotification/">l&#8217;entrada anterior sobre notificacions locals</a>. Aquesta finestra té uns botons, en pressionar-los s&#8217;altera el text que hi ha en una etiqueta (<code>UILabel</code>) que està en la vista principal. Així de senzill.

La classe <code>UIAlertView</code> ens permet representar una finestra d&#8217;alerta en una vista en concret i ho fem així:

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'>    <span class="n">UIAlertView</span> <span class="o">*</span><span class="n">ventana</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span><span class="s">@&quot;Mi Ventana&quot;</span>
</span><span class='line'>                                                      <span class="nl">message:</span><span class="s">@&quot;Aprendiendo sobre delegación en thxou.com&quot;</span>
</span><span class='line'>                                                     <span class="nl">delegate:</span><span class="n">self</span>
</span><span class='line'>                                            <span class="nl">cancelButtonTitle:</span><span class="s">@&quot;Cancelar&quot;</span>
</span><span class='line'>                                            <span class="nl">otherButtonTitles:</span><span class="s">@&quot;Limpiar Etiqueta!&quot;</span><span class="p">,</span> <span class="s">@&quot;Opción 1&quot;</span><span class="p">,</span> <span class="s">@&quot;Opción 2&quot;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>

El mètode <code>initWithTitle:message:delegate:cancelButtonTitle:otherButtonTitles</code> s&#8217;encarrega de crear l&#8217;objecte anomenat <code>ventana</code>, que és una instància de <code>UIAlertView</code>, amb una informació per defecte. Doncs bé, finestra té botons i en pressionar-los s&#8217;envia el missatge <code>alertView:clickedButtonAtIndex:</code>.Quan aquest missatge és enviat s&#8217;executa el comportament per defecte que és simplement tancar la finestra d&#8217;alerta.

Anem a fixar-nos en l&#8217;etiqueta <code>delegate:</code> del mètode en el codi d&#8217;a dalt. Sabem que prémer un botó en la finestra és un esdeveniment que dispara el missatge<code> alertView:clickedButtonAtIndex:</code>. Bé, en assignar <code>self</code> a l&#8217;etiqueta <code>delegate:</code>, li estem dient a finestra com va a ser l&#8217;encarregat de gestionar els seus esdeveniments, en el nostre cas (I com veureu en la majoria dels casos) és <code>self</code>, la nostra mateixa classe <em>ViewController</em>.

Veurem que en la majoria dels casos el delegat és assignat d&#8217;aquesta manera:

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">objeto</span> <span class="nl">setDelegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'><span class="c1">//O también</span>
</span><span class='line'><span class="n">objeto</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>

Aquest codi compleix la mateixa funció que en el nostre exemple.

Ja que no volem que en pressionar els botons s&#8217;executi el comportament per defecte, la nostra classe <code>ViewController</code> necessita implementar aquest mètode disparat per l&#8217;esdeveniment i així li diem a finestra que fer quan es pressioni un botó.

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">alertView:</span><span class="p">(</span><span class="n">UIAlertView</span> <span class="o">*</span><span class="p">)</span><span class="nv">alertView</span> <span class="nf">clickedButtonAtIndex:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">buttonIndex</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">buttonIndex</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>            <span class="n">self</span><span class="p">.</span><span class="n">mensaje</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>            <span class="n">self</span><span class="p">.</span><span class="n">mensaje</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;Haz seleccionado la opción 1&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>            <span class="n">self</span><span class="p">.</span><span class="n">mensaje</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;Haz seleccionado la opción 2&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">default</span><span class="o">:</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

La variable <code>buttonIndex</code> conté els índexs per a cadascun dels botons que conté la finestra d&#8217;alerta. Així que podem fer coses diferents depenent del &#8220;cas&#8221;.

Aquest mètode, com ja hem explicat, no és del nostre delegat, simplement estem habilitats per personalitzar la resposta a un esdeveniment usant aquest mètode, però no ho vam crear nosaltres ni definim la capçalera del mètode. Per tant el compilador ens va a llançar una excepció al moment de compilar el codi i l&#8217;aplicació petará. Per evitar això, hem de fer que el nostre delegat &#8220;sigui conforme&#8221; al protocol on està definit aquest mètode (relacionat a un esdeveniment) i tots els disparats per la finestra d&#8217;alerta.
<p style="text-align: center;"><a href="http://www.thxou.com/wp-content/uploads/2012/04/grafic-delegation.png"><img class=" wp-image-2185 aligncenter" title="grafic-delegation" src="http://www.thxou.com/wp-content/uploads/2012/04/grafic-delegation.png" alt="" width="463" height="248" /></a></p>
<p style="text-align: center;"><small>Representació del patró delegate</small></p>

<h2>Que passa amb els protocols?</h2>
Els protocols són <strong>simples llistes de mètodes sense implementar</strong>. No són classes, però si hereten de classes, tampoc podem fer instàncies d&#8217;ells ni crear variables d&#8217;instància dins d&#8217;ells. Els seus mètodes són implementats en les classes que &#8220;són conformes&#8221; a aquest protocol. Un protocol delegat és aquell usat per a la delegació, i en el nostre cas anem a necessitar el protocol delegat de <code>UIAlertView</code> que implementa el mètode <code>alertView:clickedButtonAtIndex:</code>, i est és: <code>UIAlertViewDelegate</code>. Quan ocorre un esdeveniment en l&#8217;objecte, s&#8217;envia el missatge corresponent del protocol delegat.

En un <strong>protocol delegat</strong> podem trobar-nos 2 tipus de mètodes. Uns manipulen actualitzacions d&#8217;informació, com per exemple en el cas del GPS al principi, la localització serà diferent sempre que et moguis, per tant el mètode retornarà informació diferent cada vegada; I uns altres, s&#8217;envien com a respostes a entrades de l&#8217;usuari, com en el nostre cas, quan l&#8217;usuari prem un botó de la finestra d&#8217;alerta. Hi ha alguns mètodes que podrien entrar en una tercera categoria, i és el cas de <code>alertViewShouldEnableFirstOtherButton:</code>. En aquest mètode, la finestra d&#8217;alerta pregunta al delegat si ha de mostrar habilitat o deshabilitat el primer dels botons. La resposta del delegat pot ser simplement <code>YES</code> o <code>NO</code>. En el nostre cas he posat <code>NO</code>, perquè vegis el comportament que té aquest mètode.

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">alertViewShouldEnableFirstOtherButton:</span><span class="p">(</span><span class="n">UIAlertView</span> <span class="o">*</span><span class="p">)</span><span class="nv">alertView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

Ja solament ens queda fer que el nostre delegat &#8220;sigui conforme&#8221; a <code>UIAlertViewDelegate</code>. Això ho fem en la capçalera de la nostra classe <em>ViewController.h</em> a la declaració <code>@interface</code>, entre signes de major i menor.

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> : <span class="nc">UIViewController</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">UIAlertViewDelegate</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="k">@private</span>
</span><span class='line'>    <span class="n">UILabel</span> <span class="o">*</span><span class="n">mensaje</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

He creat missatge, que és un objecte <code>UILabel</code>, per mostrar missatges depenent que botó ha estat premut.

Llest, ja hem acabat. Jo et recomano que analitzis el codi i facis canvis, molts canvis, perquè vegis com funciona la classe i el seu protocol delegat. Trobaràs enllaços a la documentació d&#8217;Apple sobre aquest tema més a baix. En aquesta mateixa aplicació d&#8217;exemple intenta afegir més mètodes de <code>UIAlertViewDelegate</code> i així saber com funcionen.

Espero haver-te ajudat a comprendre aquest tema. Qualsevol dubte o suggeriment utilitza els comentaris.

<a href="http://developer.apple.com/library/ios/#DOCUMENTATION/UIKit/Reference/UIAlertView_Class/UIAlertView/UIAlertView.html">UIAlertView</a> | <a href="http://developer.apple.com/library/ios/#DOCUMENTATION/UIKit/Reference/UIAlertViewDelegate_Protocol/UIAlertViewDelegate/UIAlertViewDelegate.html">UIAlertViewDelegate</a>
<p style="text-align: center;"><a href="http://securelink.thxou.com/?https://www.box.com/s/7f6fa46bc386d08c6100"><img class="alignnone size-full wp-image-2134" title="boton-thxou.com" src="http://www.thxou.com/wp-content/uploads/2011/11/boton-thxou.png" alt="" width="256" height="52" /></a></p></div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Luis Cardenas</span></span>

      








  


<time datetime="2012-10-19T09:39:25+02:00" pubdate data-updated="true">Oct 19<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ios-at-ca/'>iOS @ca</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://ThXou.github.io/2012/10/19/ios-aprenent-sobre-delegacio-protocols-i-la-classe-uialertview/" data-via="thxouweb" data-counturl="http://ThXou.github.io/2012/10/19/ios-aprenent-sobre-delegacio-protocols-i-la-classe-uialertview/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/10/18/ios-programant-notificacions-locals-amb-uilocalnotification/" title="Previous Post: iOS: Programant notificacions locals amb UILocalNotification">&laquo; iOS: Programant notificacions locals amb UILocalNotification</a>
      
      
        <a class="basic-alignment right" href="/2012/10/25/ios-usant-nsuserdefaults-per-assignar-configuracions-per-defecte/" title="Next Post: iOS: Usant NSUserDefaults per assignar configuracions per defecte">iOS: Usant NSUserDefaults per assignar configuracions per defecte &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/11/12/migracion-sencilla-de-modelos-en-core-data/">Migración Sencilla De Modelos en Core Data</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/25/disponible-la-segunda-beta-de-ios-7-para-desarrolladores/">Disponible La Segunda Beta De iOS 7 Para Desarrolladores</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/18/un-vistazo-al-nuevo-ios-7/">Un Vistazo Al Nuevo iOS 7</a>
      </li>
    
      <li class="post">
        <a href="/2013/03/18/literales-en-objective-c/">Literales en Objective-C</a>
      </li>
    
      <li class="post">
        <a href="/2013/02/21/nsnotificationcenter-y-las-notificaciones/">NSNotificationCenter Y Las Notificaciones</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/thxou">@thxou</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'thxou',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Luis Cardenas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'thxou';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ThXou.github.io/2012/10/19/ios-aprenent-sobre-delegacio-protocols-i-la-classe-uialertview/';
        var disqus_url = 'http://ThXou.github.io/2012/10/19/ios-aprenent-sobre-delegacio-protocols-i-la-classe-uialertview/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
